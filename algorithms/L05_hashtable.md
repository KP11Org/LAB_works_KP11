# **Лабораторная работа №5. Хеш-таблицы**

> **Цель работы**: Понять принцип работы хеш-таблиц (словарей в Python), изучить коллизии, хеширование, операции вставки и поиска, реализовать простую хеш-таблицу, применить её для решения практических задач.

---

## **Теория**

В главе 5 книги *"Грокаем алгоритмы"* рассматривается **хеш-таблица** — структура данных, позволяющая быстро хранить и извлекать пары "ключ-значение".

### Основные понятия:
- **Ключ** → преобразуется в индекс с помощью **хеш-функции**.
- **Хеш-функция** — детерминированная функция, которая для одного и того же ключа всегда возвращает одно и то же значение.
- **Коллизия** — когда два разных ключа дают один и тот же индекс. Решается методами: цепочки, открытая адресация и др.

### Преимущества:
- Среднее время поиска, вставки, удаления: **O(1)**.
- Удобна для кэширования, подсчёта, устранения дубликатов.

### В Python:
- `dict` — реализация хеш-таблицы.
- Пример: `phone_book = {'Алиса': '555-1234', 'Боб': '555-5678'}`

⚠️ Хеш-таблицы **не сохраняют порядок** (в Python < 3.7), но с 3.7+ порядок вставки сохраняется.

---

## **Практическая часть**

### 1. Создайте рабочий файл
- Создайте папку `lab5_hashtable`.
- Внутри — файл `hashtable_practice.py`.
- Откройте его в редакторе.

### 2. Используйте встроенные словари
Создайте словарь `book` для хранения информации о книге:

```python
book = {
    'название': 'Грокаем алгоритмы',
    'автор': 'Адитья Бхаргава',
    'год': 2017,
    'жанр': 'Программирование'
}
print("Книга:", book)
```

### 3. Выполняйте операции с ключами
Добавьте, измените и удалите записи:

```python
# Добавить ISBN
book['isbn'] = '978-5-905967-04-1'
# Изменить год
book['год'] = 2020
# Удалить жанр
del book['жанр']
print("После изменений:", book)
```

### 4. Реализуйте простую хеш-таблицу на списках
Создадим упрощённую хеш-таблицу с фиксированным размером (например, 10 ячеек) и методом цепочек.

```python
class SimpleHashTable:
    def __init__(self, size=10):
        self.size = size
        self.table = [[] for _ in range(size)]  # список списков

    def _hash(self, key):
        # Простая хеш-функция: сумма кодов символов по модулю размера
        return sum(ord(c) for c in str(key)) % self.size

    def insert(self, key, value):
        index = self._hash(key)
        bucket = self.table[index]
        for i, (k, v) in enumerate(bucket):
            if k == key:
                bucket[i] = (key, value)  # обновить
                return
        bucket.append((key, value))  # добавить новую пару

    def get(self, key):
        index = self._hash(key)
        bucket = self.table[index]
        for k, v in bucket:
            if k == key:
                return v
        raise KeyError(key)

    def delete(self, key):
        index = self._hash(key)
        bucket = self.table[index]
        for i, (k, v) in enumerate(bucket):
            if k == key:
                del bucket[i]
                return
        raise KeyError(key)
```

### 5. Протестируйте свою хеш-таблицу
```python
ht = SimpleHashTable()

ht.insert('Алиса', '555-1234')
ht.insert('Боб', '555-5678')
ht.insert('Чарли', '555-9999')

print("Алиса:", ht.get('Алиса'))  # 555-1234
print("Боб:", ht.get('Боб'))      # 555-5678

ht.delete('Боб')
# print(ht.get('Боб'))  # вызовет KeyError
```

### 6. Проверьте коллизии
Добавьте два ключа, дающих одинаковый хеш:

```python
# Попробуем найти коллизию (вручную или случайно)
print("Хеш 'abc':", ht._hash('abc'))
print("Хеш 'bca':", ht._hash('bca'))

ht.insert('abc', 1)
ht.insert('bca', 2)
print("abc:", ht.get('abc'))  # 1
print("bca:", ht.get('bca'))  # 2 — работает благодаря цепочкам
```

### 7. Подсчитайте количество коллизий
Добавьте счётчик коллизий:

```python
def __init__(self, size=10):
    self.size = size
    self.table = [[] for _ in range(size)]
    self.collisions = 0

def insert(self, key, value):
    index = self._hash(key)
    bucket = self.table[index]
    if bucket:
        self.collisions += 1  # коллизия, если бакет не пуст
    for i, (k, v) in enumerate(bucket):
        if k == key:
            bucket[i] = (key, value)
            return
    bucket.append((key, value))
```

После вставки нескольких элементов:

```python
print("Коллизий:", ht.collisions)
```

---

## **Самостоятельная часть**

### 1. Подсчёт частоты слов
Дан текст:
```python
text = "алгоритм хеш таблица алгоритм программирование хеш таблица хеш"
```
Напишите функцию `word_count(text)`, которая:
- Разбивает текст на слова.
- Использует словарь для подсчёта, сколько раз встречается каждое слово.
- Возвращает словарь вида `{'алгоритм': 2, 'хеш': 3, ...}`

### 2. Удаление дубликатов с помощью хеш-таблицы
Напишите функцию `remove_duplicates(lst)`, которая:
- Принимает список (например, `[1, 2, 2, 3, 4, 4, 5]`).
- Использует словарь (или множество) для отслеживания уже встреченных элементов.
- Возвращает список без дубликатов, с сохранением порядка.

> Подсказка: можно использовать `dict.fromkeys(lst)` — это автоматически уберёт дубли.

---

## **Контрольные вопросы** (ответы устно)

1. Что такое хеш-функция и какие у неё должны быть свойства?  
2. Как хеш-таблица обеспечивает среднее время доступа O(1)? Что происходит при коллизиях?

---

## **Слепая печать**
1. Пройдите два урока слепой печати на [Python](https://stamina-online.com/ru/workout/programming/15)

---

## **Критерии оценивания**

| Часть работы              | Оценка | Комментарий |
|--------------------------|--------|-------------|
| Практическая часть       | 3      | Все шаги выполнены, код работает корректно |
| Слепая печать            | 4      | Подтверждено выполнение |
| Самостоятельная часть    | 5      | Задачи решены, особенно использование хеш-таблицы для подсчёта и фильтрации |
