# **Лабораторная работа №7 (2 урока)**  
## **Тема: Работа с несколькими таблицами. JOIN (INNER, LEFT). Связи между таблицами**

---

### **1. Немного теории**

В реальных базах данных информация распределена по **нескольким таблицам**. Например:
- `Students` — студенты
- `Groups` — группы с информацией о специальности, курсе и т.д.
- `Teachers` — преподаватели

Чтобы получать данные из нескольких таблиц одновременно, используются **JOIN** — операции соединения таблиц.

**Основные типы JOIN:**
- `INNER JOIN` — возвращает только строки, у которых есть совпадения в обеих таблицах.
- `LEFT JOIN` — возвращает **все строки** из левой таблицы и совпадающие — из правой. Если совпадений нет — `NULL`.

**Пример связи:**
Представим, что у нас есть таблица `Groups`, и в `Students` будет поле `group_id`, ссылающееся на `id` из `Groups`.

Синтаксис:
```sql
SELECT Students.name, Groups.name 
FROM Students
INNER JOIN Groups ON Students.group_id = Groups.id;
```

---

### **2. Практическая часть**

**Цель:** Создать таблицу `Groups`, установить связь с `Students` и научиться использовать `JOIN`.

#### **Шаг 1: Создание таблицы Groups**
1. В SQLite Studio кликните правой кнопкой по `students.db` → **"Create Table"**.
2. Назовите таблицу: `Groups`
3. Добавьте поля:
   - `id` → INTEGER, **Primary Key**, **Autoincrement**
   - `group_name` → TEXT, **Not NULL**
   - `specialty` → TEXT
   - `course` → INTEGER
4. Нажмите **"OK"**, затем **"Apply"**.

#### **Шаг 2: Заполнение таблицы Groups**
1. Перейдите на вкладку **"SQL"**.
2. Введите запрос:
```sql
INSERT INTO Groups (group_name, specialty, course) VALUES
('ИТ-101', 'Информационные технологии', 1),
('ИТ-102', 'Информационные технологии', 1),
('ИТ-103', 'Информационные технологии', 1),
('ПД-201', 'Программная инженерия', 2);
```
3. Выполните.

#### **Шаг 3: Модификация таблицы Students (добавление group_id)**
1. Кликните правой кнопкой по таблице `Students` → **"Modify Table"**.
2. Удалите столбец `group_name` (выделите его → кнопка "–").
3. Добавьте новый столбец:
   - Имя: `group_id`
   - Тип: `INTEGER`
   - Галочка: **"Not NULL"**
4. Нажмите **"Apply"**.

> ⚠️ SQLite не поддерживает прямое переименование/удаление столбцов. Если возникнут ошибки — можно пересоздать таблицу.  
> Но в SQLite Studio редактирование работает через внутренние преобразования.

#### **Шаг 4: Обновление данных в Students**
1. Теперь нужно связать студентов с `group_id`. Узнаем `id` групп:
```sql
SELECT * FROM Groups;
```
2. Допустим:
   - ИТ-101 → id=1
   - ИТ-102 → id=2
   - ИТ-103 → id=3

3. Обновите студентов:
```sql
UPDATE Students SET group_id = 1 WHERE id = 1;  -- Иван → ИТ-101
UPDATE Students SET group_id = 2 WHERE id = 2;  -- Мария → ИТ-102
UPDATE Students SET group_id = 1 WHERE id = 3;  -- Алексей → ИТ-101
UPDATE Students SET group_id = 3 WHERE id = 5;  -- (если Елена была восстановлена)
```

#### **Шаг 5: INNER JOIN — соединение таблиц**
1. Получим имена студентов и названия их групп:
```sql
SELECT 
    Students.name,
    Groups.group_name,
    Groups.specialty
FROM Students
INNER JOIN Groups ON Students.group_id = Groups.id;
```
2. Результат: только те студенты, у которых `group_id` совпадает с `id` в `Groups`.

#### **Шаг 6: LEFT JOIN — все студенты, даже если группа не найдена**
1. Представим, что у одного студента `group_id = 99` (несуществующий):
```sql
UPDATE Students SET group_id = 99 WHERE id = 1;
```
2. Выполним `LEFT JOIN`:
```sql
SELECT 
    Students.name,
    Groups.group_name
FROM Students
LEFT JOIN Groups ON Students.group_id = Groups.id;
```
3. Результат: все студенты, но для Ивана `group_name` будет `NULL`.

#### **Шаг 7: Использование JOIN с условиями и агрегатами**
1. Посчитаем, сколько студентов в каждой специальности:
```sql
SELECT 
    Groups.specialty,
    COUNT(*) AS student_count
FROM Students
INNER JOIN Groups ON Students.group_id = Groups.id
GROUP BY Groups.specialty;
```

---

### **3. Самостоятельная часть**

> Выполняется самостоятельно.

1. Выведите **имя студента, название группы и курс**, используя `INNER JOIN`.

2. Покажите **все группы** и количество студентов в каждой (включая те, где студентов нет). Используйте `LEFT JOIN` от `Groups` к `Students`.

3. Найдите, в каких **специальностях** учатся студенты старше 20 лет. Выведите специальность и количество таких студентов.

---

### **4. Контрольные вопросы**

1. Чем отличается `INNER JOIN` от `LEFT JOIN`?  
2. Зачем нужны связи между таблицами? Что будет, если не использовать `JOIN`?

> Ответы дайте устно при защите работы.

---

### **5. Слепая печать**

1. Перейдите на сайт [stamina-online](https://stamina-online.com/ru/programming)
2. Пройдите два урока по [языку программирования SQL](https://stamina-online.com/ru/workout/programming/18)

---

### **6. Критерии оценивания**

| Критерий                  | Оценка | Примечание |
|---------------------------|--------|------------|
| Практическая часть        | 3      | Таблицы связаны, JOIN работает корректно |
| Слепая печать             | 4      | Работа выполнена |
| Самостоятельная часть     | 5      | Запросы с JOIN, LEFT JOIN, GROUP BY составлены правильно, синтаксис соблюдён |
